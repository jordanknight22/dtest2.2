{% load custom_tags %}

<a href="/rates">
    <h1>Back</h1>
</a>

<hr>

<table border="1" style="border-collapse: collapse; width: 100%; text-align: center;">
    <thead>
        <!-- Row 1: Pet Type -->
        <tr>
            <th>Pet Type</th>
            {% for pet_type, schemes in nested_rates.items %}
                <th colspan="{{ schemes|length }}">{{ pet_type|capfirst }}</th>
            {% endfor %}
        </tr>

        <!-- Row 2: Scheme -->
        <tr>
            <th>Scheme</th>
            {% for pet_type, schemes in nested_rates.items %}
                {% for scheme, factors in schemes.items %}
                    <th>{{ scheme|capfirst|cut:"_" }}</th>
                {% endfor %}
            {% endfor %}
        </tr>

        <!-- Row 3: Limit -->
        <tr>
            <th>Limit</th>
            {% for pet_type, schemes in nested_rates.items %}
                {% for scheme, factors in schemes.items %}
                    <td>{{ factors|dict_key:"limit" }}</td>
                {% endfor %}
            {% endfor %}
        </tr>
    </thead>
        <tr>
            <th>Pre-existing Medical Conditions?</th>
        </tr>
    <tbody>
        <tr>
            <th>Pre-Existing (No)</th>
            {% for pet_type, schemes in nested_rates.items %}
                {% for scheme, factors in schemes.items %}
                    <td>
                        {{ factors|dict_key:"pre_existing"|dict_key:"no"|floatformat:3 }}
                    </td>
                {% endfor %}
            {% endfor %}
        </tr>
        <tr>
            <th>Pre-Existing (Yes)</th>
            {% for pet_type, schemes in nested_rates.items %}
                {% for scheme, factors in schemes.items %}
                    <td>
                        {{ factors|dict_key:"pre_existing"|dict_key:"yes"|floatformat:3 }}
                    </td>
                {% endfor %}
            {% endfor %}
        </tr>
    </tbody>